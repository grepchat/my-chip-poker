<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHIP — Сессии</title>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .card { background: rgba(255,255,255,0.06); border-radius: 12px; padding: 16px; margin: 12px; }
    .row { display:flex; justify-content:space-between; align-items:center; }
    .btn { padding:8px 12px; border-radius:10px; background:#FFD166; color:#181c1f; border:none; font-weight:700; cursor:pointer; }
    .muted { opacity:.75; font-size:13px; }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="index.html" class="logo" aria-label="Главная">
      <img src="assets/img/logo.png" alt="CHIP логотип">
      <span class="logo-title">CHIP</span>
    </a>
    <div style="display:flex; gap:12px; align-items:center;">
      <a href="profile.html" class="profile-link" aria-label="Профиль" title="Профиль">
        <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
      </a>
      <button id="openLogin" class="btn">Войти</button>
      <button id="openRegister" class="btn alt">Зарегистрироваться</button>
    </div>
  </div>
  <div class="calc-screen" style="max-width:720px;">
    <h2 class="section-title">Мои сессии</h2>
    <div id="list"></div>
  </div>
  <nav class="bottom-nav">
    <a href="calculator.html" class="bottom-nav-btn">
      <svg viewBox="0 0 24 24">
        <rect x="5" y="3" width="14" height="18" rx="3"/>
        <rect x="8" y="7" width="8" height="2" rx="1" fill="#bfa040"/>
        <rect x="8" y="11" width="3" height="3" rx="1"/>
        <rect x="13" y="11" width="3" height="3" rx="1"/>
        <rect x="8" y="15" width="3" height="3" rx="1"/>
        <rect x="13" y="15" width="3" height="3" rx="1"/>
      </svg>
      Калькулятор
    </a>
    <a href="index.html" class="bottom-nav-btn">
      <svg viewBox="0 0 24 24"><path d="M4 12L12 4l8 8v8H4z"/></svg>
      Главная
    </a>
    <a href="poker.html" class="bottom-nav-btn">
      <svg viewBox="0 0 24 24">
        <circle cx="9" cy="10" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
        <path d="M7 10h4M6.5 8.5h3M6.5 11.5h3" stroke="#bfa040" stroke-width="2" stroke-linecap="round"/>
        <circle cx="14.5" cy="13.5" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
        <path d="M12.5 13.5h4M12 12h3M12 15h3" stroke="#bfa040" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Покер
    </a>
    <a href="combinations.html" class="bottom-nav-btn">
      <svg viewBox="0 0 24 24"><path d="M7 4h10l3 5-8 11-8-11 3-5z"/></svg>
      Комбинации
    </a>
  </nav>

  <script type="module">
    import { Sessions } from './assets/js/api.js';

    async function load() {
      const container = document.getElementById('list');
      container.innerHTML = '';
      try {
        const items = await Sessions.listMine();
        if (!items.length) {
          container.innerHTML = '<div class="card">Нет сохранённых сессий</div>';
          return;
        }
        items.forEach(s => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div class="row">
              <div>
                <div><strong>${s.title || 'Сессия'}</strong></div>
                <div class="muted">${new Date(s.created_at).toLocaleString('ru-RU')} • Цена фишки: ${s.cost_per_chip.toFixed(2)}</div>
              </div>
              <div>
                <a class="btn" href="calculator.html#load=${s.id}">Загрузить</a>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (e) {
        container.innerHTML = '<div class="card">Авторизуйтесь, чтобы видеть историю.</div>';
      }
    }
    load();
  </script>
  <script type="module" src="assets/js/auth-modal.js"></script>
  <script type="module" src="assets/js/header-auth.js"></script>
</body>
</html>
